<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Scandit CDN Simple sample</title>
    <script type="importmap">
      {
        "imports": {
          "@scandit/web-datacapture-core": "https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-core@7.3.0/build/js/index.js",
          "@scandit/web-datacapture-barcode": "https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-barcode@7.3.0/build/js/index.js",

          "@scandit/web-datacapture-barcode/": "https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-barcode@7.3.0/",
          "@scandit/web-datacapture-core/": "https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-core@7.3.0/"
        }
      }
    </script>
    <link
      rel="modulepreload"
      href="https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-core@7.3.0/build/js/index.js"
    />
    <link
      rel="modulepreload"
      href="https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-barcode@7.3.0/build/js/index.js"
    />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
      }
      #interactive {
        width: 100%;
        height: 40%;
      }
    </style>
    <!-- Check the latest version here https://github.com/guybedford/es-module-shims/releases -->
    <script
      async
      src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"
    ></script>
    <script type="module">
      import {
        Camera,
        loadingStatus,
        configure,
        DataCaptureContext,
        DataCaptureView,
        FrameSourceState 
      } from "@scandit/web-datacapture-core";

      import {
        barcodeCaptureLoader,
        BarcodeCaptureSettings,
        BarcodeCapture,
        Symbology,
        SymbologyDescription,
        BarcodeCaptureOverlay,
      } from "@scandit/web-datacapture-barcode";

      loadingStatus.subscribe((info) => {
        console.log(info.percentage, info.loadedBytes);
      });

      await configure({
        licenseKey:
          "AnZ2/7eBI3lMHjyLdem8/D4mrkrjAEPbghRy5GK/wvufBPxgRznqxTJm8F4TYVL88npEiKZi+F4Yfp7Tom897GkFyvhWdK75aEyCMq1OhZSZftt2QTA5qidvx5XOXpAFC0Q5I41oFcGtA03T1z/nVQk6OTyYFz/Lf++qt6Ci+QChE46C132gfu+nSWQBEDAd3iu5p5oCUq/Cqpt9w9WDkcvZaCLBRlIdbxzyoFkWOJQrqlMnsGiJVc0s81EQVVYMe67ntfSneXuYF0P35abZfUGHtBkl2vVW5Ug5ofQ7Wax2rKEhXj19w8YySiDpJ7XPugFxTzxBFETZ7kgh/DoLYCcH3W0xWOVteXwSgOioM1EKrYXISyh6lvLdqhIlqaQY84XFbY5GAUNsP3EGy/SnnaeY/WyW0Vas8/UqgrwyiuXpNVP6UFmgAvHbjiLQWyqlU7JjFvk1HZQuTaPkubPMNVh+UxRv5bdufn5NYP+OFPHrMDynv5/cjQ+Srr3bM9eoHObsxQ3/mwdaNxqGkajmVAZN9v+UTlZwgojDdlEdqDJZg8m3J7Ek70K4Iv84jpR5Kl/324Uk75qz06/rQuXhCq1E/scccrq0oGsFSnSMw+ki2157KLilmC19XNiqmKxIuN62D+Xx09bVNAfiri/vnCkGxukX/nRRNsukyUnT7CRBKtqI3BZDaKhXNsjQBqOoe0j8JArUxUZp3yzBXTL2s06orvzBzXhsN9Sc2vhEFoPUQr4vfvwcbNkDWmpKRsXPE6TfZ9EasUnUQ/8SnwwMTDAgzddsUgBWTkK0ZQWFzgBqqXA13nVY/bfNYQxO0A6bJdO91K5l",
        libraryLocation:
          "https://cdn.jsdelivr.net/npm/@scandit/web-datacapture-barcode@7.3.0/sdc-lib/",
        moduleLoaders: [barcodeCaptureLoader()],
      });

      const context = await DataCaptureContext.create();
      const settings = new BarcodeCaptureSettings();
      settings.enableSymbologies([
        Symbology.Code128,
        Symbology.Code39,
        Symbology.QR,
        Symbology.EAN8,
        Symbology.UPCE,
        Symbology.EAN13UPCA,
      ]);
      const view = await DataCaptureView.forContext(context);
      view.connectToElement(document.querySelector("#interactive"));
      const barcodeCapture = await BarcodeCapture.forContext(context, settings);

      const cameraSettings = BarcodeCapture.recommendedCameraSettings;
      const camera = Camera.default;
      await camera.applySettings(cameraSettings);
      await context.setFrameSource(camera);
      await context.frameSource.switchToDesiredState(FrameSourceState.On);
      const overlay = await BarcodeCaptureOverlay.withBarcodeCaptureForView(
        barcodeCapture,
        view
      );
      
      barcodeCapture.addListener({
        didScan: async (barcodeCaptureMode, session) => {
          const barcode = session.newlyRecognizedBarcode;
          if (!barcode) {
            return;
          }
          const symbology = new SymbologyDescription(barcode.symbology);
          alert(`Scanned: ${barcode.data ?? ""}\n(${symbology.readableName})`);
        },
      });

      await barcodeCapture.setEnabled(true);
    </script>
  </head>
  <body>
    <div id="interactive"></div>
  </body>
</html>
