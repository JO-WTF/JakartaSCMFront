<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DU 提交记录管理</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#0b1020;color:#eaf2ff}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:#101831;border:1px solid #1f2a4d;border-radius:14px;padding:14px;margin-top:14px}
    label{font-size:12px;color:#8aa2c8}
    input,select,textarea{background:#0e1631;color:#eaf2ff;border:1px solid #2a3a66;border-radius:10px;padding:8px 10px}
    input[type="date"]{min-width:180px}
    textarea{min-height:140px;resize:none;line-height:1.5} /* 固定高度，由父级网格拉伸匹配右列总高 */

    .btn{appearance:none;border:0;border-radius:999px;padding:10px 16px;font-weight:700;background:#69a8ff;color:#07122b;cursor:pointer}
    .ghost{background:#12182b;color:#eaf2ff}
    .danger{background:#ff6b6b;color:#07122b}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #1f2a4d;text-align:left;font-size:14px;vertical-align:top}
    a{color:#69a8ff}
    .muted{color:#8aa2c8;font-size:12px}
    .pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px}
    .actions{display:flex;gap:8px}

    /* 顶部筛选区：两列网格 */
    .grid-2col{
      display:grid;
      grid-template-columns: 1fr 1.6fr; /* 左：DU输入；右：条件区 */
      gap:12px;
      align-items:stretch; /* 让两列等高 */
    }
    .du-col{display:flex;flex-direction:column}
    .du-col textarea{flex:1} /* 占满左列高度 */

    .rhs{display:grid;grid-template-rows:auto auto;gap:12px}
    .row-line{display:flex;gap:10px;flex-wrap:wrap;align-items:end}
    .field{display:flex;flex-direction:column;gap:6px}
    .field.grow{flex:1;min-width:220px}
    .w120{width:120px}
    .modal-mask {
      position: fixed;
      inset: 0; /* 顶、右、底、左全覆盖 */
      background: rgba(0,0,0,.35);
      display: none;              /* 默认不显示 */
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal {
      background: #0f1730;
      border: 1px solid #283760;
      border-radius: 14px;
      max-width: 520px;
      width: 92%;
      padding: 14px;
    }
    /* 包裹容器：把高亮层垫底，textarea 盖在上面 */
    .du-wrap{
      position: relative;
      width: 100%;
      min-height: 140px;
    }
    .du-wrap textarea,
    .du-wrap .du-hilite{
      font: inherit;
      line-height: 1.5;
      padding: 8px 10px;
      border-radius: 10px;
      min-height: 140px;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow: auto;
    }

    /* 高亮层：与 textarea 同尺寸、同内边距，放底层显示颜色 */
    .du-hilite{
      position: absolute;
      inset: 0;
      color: transparent;          /* 让非高亮文字不可见，只显示背景块 */
      background: transparent;
      border: 1px solid #2a3a66;   /* 让“看起来像输入框” */
      pointer-events: none;        /* 点击落到 textarea 上 */
      z-index: 0;
    }

    /* 让 textarea 透明并盖在上面，负责输入 */
    .du-wrap textarea{
      position: relative;
      background: transparent;
      border: 1px solid #2a3a66;
      z-index: 1;
      resize: none;                /* 保持与你之前的固定高度一致 */
    }

    /* token 着色：ok=合法，bad=非法 */
    .hl-ok{
      background: rgba(34,197,94,.25);    /* 绿 */
      color: #eaf2ff;
      border-radius: 4px;
      padding: 0 2px;
    }
    .hl-bad{
      background: rgba(239,68,68,.28);    /* 红 */
      color: #eaf2ff;
      border-radius: 4px;
      padding: 0 2px;
    }

    /* 分隔符（换行/逗号/空格）保持透明，仅用于占位 */
    .hl-sep{ background: transparent; color: transparent; }

  </style>
  <script>
    // 按需改为你的后端域名；注释掉则默认同源
    window.API_BASE = "https://jakartabackend.onrender.com";
  </script>
</head>
<body>
  <div class="container">
    <h2>DU 提交记录管理</h2>

    <!-- 筛选区：左列 DU，多行；右列两行条件 -->
    <div class="card">
      <div class="grid-2col">
        <!-- 左列：DU 输入 -->
        <div class="du-col">
          <label>DU ID（支持多行/逗号/空格分隔；多于1个则批量查询）</label>

          <!-- 包裹：高亮层 + 文本域 -->
          <div class="du-wrap">
            <div id="du-hilite" class="du-hilite" aria-hidden="true"></div>
            <textarea id="f-du" placeholder="示例：&#10;DID123...&#10;DID456...&#10;或：DID123..., DID456..."></textarea>
          </div>

          <div class="muted" style="margin-top:6px">
            提示：输入小写 did 会自动转为 DID；合法格式为 <code>DID + 13位数字</code>。
          </div>
        </div>


        <!-- 右列 -->
        <div class="rhs">
          <!-- 第一行 -->
          <div class="row-line">
            <div class="field">
              <label>状态</label>
              <select id="f-status">
                <option value="">（全部）</option>
                <option value="运输中">运输中</option>
                <option value="过夜">过夜</option>
                <option value="已到达">已到达</option>
              </select>
            </div>

            <div class="field grow">
              <label>备注关键词</label>
              <input id="f-remark" placeholder="模糊匹配">
            </div>

            <div class="field">
              <label>是否带附件</label>
              <select id="f-has">
                <option value="">（不限）</option>
                <option value="true">有附件</option>
                <option value="false">无附件</option>
              </select>
            </div>

            <div class="field">
              <label>每页数量</label>
              <input id="f-ps2" type="number" min="1" max="100" value="20" class="w120">
            </div>
          </div>

          <!-- 第二行 -->
          <div class="row-line">
            <div class="field">
              <label>开始日期</label>
              <input id="f-from" type="date">
            </div>
            <div class="field">
              <label>结束日期</label>
              <input id="f-to" type="date">
            </div>
          </div>

          <!-- 第三行：操作按钮 -->
          <div class="row-line">
            <div class="field" style="gap:8px;flex:1">
              <label style="visibility:hidden">操作</label>
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn" id="btn-search">查询</button>
                <button class="btn ghost" id="btn-reset">重置</button>
                <button class="btn ghost" id="btn-export-all">导出全部</button>
                <button class="btn ghost" id="btn-trust-backend-link">信任后台</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 结果表格 -->
    <div class="card">
      <div id="hint" class="muted">输入条件后点击查询。</div>
      <table id="tbl" style="display:none">
        <thead>
          <tr>
            <th>ID</th><th>DU ID</th><th>状态</th><th>备注</th><th>照片</th><th>时间</th><th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="pager" id="pager" style="display:none">
        <button class="ghost" id="prev">上一页</button>
        <span id="pginfo" class="muted"></span>
        <button class="ghost" id="next">下一页</button>
      </div>
    </div>
  </div>

  <!-- 编辑弹窗 -->
  <div id="modal-mask" class="modal-mask">
    <div class="modal">
      <h3>编辑记录 <span id="modal-id" class="tag"></span></h3>
      <div class="row-line">
        <div class="field">
          <label>状态</label>
          <select id="m-status">
            <option value="">（不修改）</option>
            <option value="运输中">运输中</option>
            <option value="过夜">过夜</option>
            <option value="已到达">已到达</option>
          </select>
        </div>
        <div class="field grow">
          <label>备注</label>
          <input id="m-remark" placeholder="不修改请留空">
        </div>
        <div class="field grow">
          <label>替换照片（可选）</label>
          <input id="m-photo" type="file" accept="image/*">
        </div>
      </div>
      <div class="foot">
        <button class="btn ghost" id="m-cancel">取消</button>
        <button class="btn" id="m-save">保存</button>
      </div>
      <div class="muted" id="m-msg" style="margin-top:6px"></div>
    </div>
  </div>

  <script src="./admin.js"></script>
</body>
</html>
