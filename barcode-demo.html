<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>扫码 Demo</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    video { width: 100%; max-width: 400px; border: 1px solid #ccc; margin: 10px 0; }
    select, button { margin: 5px; padding: 8px; font-size: 14px; }
    #result { margin-top: 10px; font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h1>二维码扫码 Demo</h1>
  <p>请选择摄像头并点击开始扫码</p>
  
  <select id="cameraSelect"></select>
  <br>
  <button id="startButton">开始扫码</button>
  <button id="resetButton">停止</button>

  <div>
    <video id="video" autoplay muted playsinline></video>
  </div>
  
  <div id="result">扫描结��会显示在这里</div>

  <!-- 引入 ZXing -->
  <script src="https://unpkg.com/@zxing/library@0.18.6"></script>
  <script>
    const codeReader = new ZXing.BrowserMultiFormatReader();
    const videoElement = document.getElementById('video');
    const cameraSelect = document.getElementById('cameraSelect');
    const resultElement = document.getElementById('result');
    const startButton = document.getElementById('startButton');
    const resetButton = document.getElementById('resetButton');
    let selectedDeviceId = null;

    // 列出可用摄像头
    codeReader.listVideoInputDevices().then(videoInputDevices => {
      if (videoInputDevices.length === 0) {
        alert("没有检测到摄像头！");
        return;
      }

      videoInputDevices.forEach((device, index) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        option.text = device.label || `摄像头 ${index + 1}`;
        cameraSelect.appendChild(option);
      });

      // 默认选第一个
      selectedDeviceId = videoInputDevices[0].deviceId;
      cameraSelect.onchange = () => {
        selectedDeviceId = cameraSelect.value;
      };
    });

    // 开始扫码
    startButton.addEventListener('click', () => {
      resultElement.textContent = "正在扫描...";
      codeReader.decodeFromVideoDevice(selectedDeviceId, videoElement, (result, err) => {
        if (result) {
          resultElement.textContent = "扫描结果：" + result.getText();
          console.log(result.getText());
        }
        if (err && !(err instanceof ZXing.NotFoundException)) {
          console.error(err);
        }
      });
    });

    // 停止扫码
    resetButton.addEventListener('click', () => {
      codeReader.reset();
      resultElement.textContent = "已停止扫描";
    });
  </script>
</body>
</html>
